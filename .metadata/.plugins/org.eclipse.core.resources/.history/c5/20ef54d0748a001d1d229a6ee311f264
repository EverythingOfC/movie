package service;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import dao.MovieDao;
import dto.MovieDto;
import dto.PagingDto;

public class MovieList implements Action {

	@Override
	public void execute(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		// 현재 페이지 설정
		int curr = 1;	// 현재 페이지 기본 값
		if(request.getParameter("page") != null) {	// 넘어온 페이지 값이 있는 경우
			curr = Integer.parseInt(request.getParameter("page"));
		}
		PagingDto pDto = new PagingDto();
		pDto.setCurrentPage(curr);
		
		
		// 전체 페이지 설정
		MovieDao mDao = MovieDao.getInstance();
		pDto.setTotalCount(mDao.allCount());	// 게시글 총 개수 리턴
		
		
		
		
		String url = "/movie/list.jsp";
		
		MovieDao mDao = MovieDao.getInstance();
		List<MovieDto> lMdto = new ArrayList<>();
		
		lMdto = mDao.selectAllPaging(curr);	// 쿼리셋 반환
		
		request.setAttribute("movies", lMdto);	// 리스트 영화 데이터를 세션으로 저장
		
		request.getRequestDispatcher(url).forward(request, response);
	}

}
